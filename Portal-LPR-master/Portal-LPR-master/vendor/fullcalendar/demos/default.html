<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<link href='../fullcalendar.css' rel='stylesheet' />
<link href='../fullcalendar.print.css' rel='stylesheet' media='print' />
<script src='../lib/moment.min.js'></script>
<script src='../lib/jquery.min.js'></script>
<script src='../fullcalendar.min.js'></script>
<script>

	$(document).ready(function() {

		$('#calendar').fullCalendar({

			 header:{

                left: 'prev,next today',

                center: 'title',

                right: 'agendaWeek,agendaDay'

            },

			defaultDate: '2016-09-12',
			editable: true,
			eventLimit: true, // allow "more" link when too many events
			events: [
				{
					title: 'All Day Event',
					start: '2016-09-01'
				},
				{
					title: 'Long Event',
					start: '2016-09-07',
					end: '2016-09-10'
				},
				{
					id: 999,
					title: 'Repeating Event',
					start: '2016-09-09T16:00:00'
				},
				{
					id: 999,
					title: 'Repeating Event',
					start: '2016-09-16T16:00:00'
				},
				{
					title: 'Conference',
					start: '2016-09-11',
					end: '2016-09-13'
				},
				{
					title: 'Meeting',
					start: '2016-09-12T10:30:00',
					end: '2016-09-12T12:30:00'
				},
				{
					title: 'Lunch',
					start: '2016-09-12T12:00:00'
				},
				{
					title: 'Meeting',
					start: '2016-09-12T14:30:00'
				},
				{
					title: 'Happy Hour',
					start: '2016-09-12T17:30:00'
				},
				{
					title: 'Dinner',
					start: '2016-09-12T20:00:00'
				},
				{
					title: 'Birthday Party',
					start: '2016-09-13T07:00:00'
				},
				{
					title: 'Click for Google',
					url: 'http://google.com/',
					start: '2016-09-28'
				}
			]
		});
		
	});

 events: "index.php?view=1",  // request to load current events

   

            

            eventClick:  function(event, jsEvent, view) {  // when some one click on any event

                endtime = $.fullCalendar.moment(event.end_date).format('h:mm');

                starttime = $.fullCalendar.moment(event.start_date).format('dddd, MMMM Do YYYY, h:mm');

                var mywhen = starttime + ' – ' + endtime;

                $('#modalTitle').html(event.title);

                $('#modalWhen').text(mywhen);

                $('#eventID').val(event.event_id);

                $('#calendarModal').modal();

            },

            

            select: function(start_date, end_date, jsEvent) {  // click on empty time slot

                endtime = $.fullCalendar.moment(end_date).format('h:mm');

                starttime = $.fullCalendar.moment(start_date).format('dddd, MMMM Do YYYY, h:mm');

                var mywhen = starttime + ' – ' + endtime;

                start = moment(start_date).format();

                end = moment(end_date).format();

                $('#createEventModal #startTime').val(start_date);

                $('#createEventModal #endTime').val(end_date);

                $('#createEventModal #when').text(mywhen);

                $('#createEventModal').modal('toggle');

           },

           eventDrop: function(event, delta){ // event drag and drop

               $.ajax({

                   url: 'index.php',

                   data: 'action=update&title='+event.title+'&start_date='+moment(event.start_date).format()+'&end_date='+moment(event.end_date).format()+'&event_id='+event.event_id ,

                   type: "POST",

                   success: function(json) {

                   //alert(json);

                   }

               });

           },

           eventResize: function(event) {  // resize to increase or decrease time of event

               $.ajax({

                   url: 'index.php',

                   data: 'action=update&event_name='+event.event_name+'&start_date='+moment(event.start_date).format()+'&end_date='+moment(event.end_date).format()+'&event_id='+event.event_id,

                   type: "POST",

                   success: function(json) {

                       //alert(json);

                   }

               });

           }

        });

               

       $('#submitButton').on('click', function(e){ // add event submit

           // We don’t want this to act as a link so cancel the link action

           e.preventDefault();

           doSubmit(); // send to form submit function

       });


       //delete event clicked

           // We don’t want this to act as a link so cancel the link action


       

       $('#deleteButton').on('click', function(e){ 
           
          e.preventDefault();

          doDelete();        

       });

       

       function doDelete(){  // delete event 

           $("#calendarModal").modal('hide');

           var eventID = $('#eventID').val();

           $.ajax({

               url: 'index.php',

               data: 'action=delete&event_id='+eventID,

               type: "POST",

               success: function(json) {

                   if(json == 1)

                        $("#calendar").fullCalendar('removeEvents',eventID);

                   else

                        return false;

                    

                   

               }

           });

       }

       function doSubmit(){ // add event

           $("#createEventModal").modal('hide');

           var title = $('#title').val();

           var startTime = $('#startTime').val();

           var endTime = $('#endTime').val();

           

           $.ajax({

               url: 'index.php',

               data: 'action=add&event_name='+event_name+'&start_date='+startTime+'&end_date='+endTime,

               type: "POST",

               success: function(json) {

                   $("#calendar").fullCalendar('renderEvent',

                   {

                       event_id: json.event_id,

                       event_name: title,

                       start_date: startTime,

                       end_date: endTime,

                   },

                   true);

               }

           });

           

       }

    });


</script>
<style>

	body {
		margin: 40px 10px;
		padding: 0;
		font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
		font-size: 14px;
	}

	#calendar {
		max-width: 900px;
		margin: 0 auto;
	}

</style>
</head>
<body>

	<div id='calendar'></div>

</body>
</html>
